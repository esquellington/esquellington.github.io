#+title: That time I saw a weird rainbow
#+date: <2024-11-17 dom>
#+author: Oscar

In May 2019 I saw this mysterious rainbow over Edinburgh. At first
sight it may look like a common double rainbow, but if you focus on
the bases you can see that they intersect.

#+ATTR_HTML: :alt Weird Rainbow :width 50%
[[../img/Rainbow/Rainbow-2019-05-22-MILLORAT.jpeg]]

Double rainbows are concentric, so they're not supposed to intersect!
something else must be going on... so I started reading a bit to find
out exactly what.

It was a fun trip and I ended up with satisfying answer ([[So, what did I see?][spoiler]]) and
a new question ([[Test 2: Distances (to gold at the base!)][how far is the rainbow?]])

/(NB: All inline pictures are mine)/

* Rain-bows-tiary

After this terrible pun, let's have a quick look at the different
kinds of rainbows that have been observed and studied, and try to
classify the one in the picture above.

** TODO Single rainbow
A single *primary* bow can be seen when sunlight rays are refracted
once inside rain droplets, split into different wavelengths (colours)
and travel towards the observer standing between the Sun and the
rainbow. Rays are refracted around /42 degrees/ downwards. More
details [[https://www.atoptics.co.uk/rainbows/primary.htm][here]].

~TODO~ side diagram of single reflection inside spherical droplet and angles

** DONE Concentric rainbows
Single rainbows are awesome on their own, but sometimes they're
accompained by additional concentric bows:
- A *secondary* bow is caused by extra refractions of light inside
  rain doplets. The secondary bow is concentric to primary one,
  appears outside and is significantly fainter. The secondary bow
  colors are reversed. Primary + secondary form the relatively
  common /double rainbow/ that everybody loves. More details [[https://www.atoptics.co.uk/rainbows/sec.htm][here]].
- Supernumerary bows can appear adjacent to the inside of any bow and
  seem to repeat the same color pattern, but compressed. They are
  caused by lightwave interference. More detals [[https://www.atoptics.co.uk/rainbows/supers.htm][here]].

The picture below shows a faint secondary bow above the primary one,
and part of a supernumerary right below the primary violet shade.
#+ATTR_HTML: :alt Double Rainbow with supernumerary :width 90%
[[../img/Rainbow/Rainbow-2019-10-29-Super.jpg]]

These are very cool, but definitely not what I saw.

** TODO Reflection rainbows
Reflection rainbows are formed by two separate bows: a primary one
caused by direct sunlight, and a *reflection* one above the primary,
caused by sunlight reflected on a water surface that must be behind
the observer, and calm enough for sunlight to reflect in a coherent
direction instead of scattering. The reflection bow is not concentric,
and appears above the primary one. More details [[https://www.atoptics.co.uk/rainbows/bowim6.htm][here]].

~TODO~ side diagram of primary + reflection ray trajectories inside
spherical droplets at 2 different heights/angles to same observer

** DONE Twinned rainbows
Twinned rainbows are very rare, and apparently not yet fully
understood. A possible explanation is that they're primary bows that
bifurcate in some sections due to the presence of larger droplets that
become non-spherical under the effect of air friction, and refract
light in a slightly different direction, so the rays that reach the
observer come from slightly above/below the primary bow. More details
[[https://www.atoptics.co.uk/rainbows/bowim28.htm][here]].

* So, what did I see?
Given that the 2 bows in my picture were not concentric they could
only be a twinned primary bow, or a pair of primary and a reflection
bows. I very much suspected it was primary + reflection but I had no
proof. A sane person would have probably stopped there. I didn't.

My shamelessly biased starting assumption was: /If I can prove that a
reflection bow was very likely, then it probably was, given how rare
twinned bows seem to be, and how hard it would be to prove that it was
a twinned bow instead/.

So yeah, I essentially looked for my keys under the [[https://en.wikipedia.org/wiki/Streetlight_effect][streetlight]], not
where I had probably lost them.

The good news is that using my picture, some basic trigonometry and
publically available maps and astronomical data, I arrived at a pretty
convincing answer: The picture matches a predicted ~reflection bow~
with surprising accuracy (3%), so it most likely was. Below I'll
detail how I arrived at this conclusion

** Method

~TODO~ REUSE previous diagram with primary+reflection, compact angle

I unitaterally decided had to answer these 2 questions:
1. /Is there a water surface where the Sun may have reflected?/
2. /Does the separation between primary and reflection bows in the
   picture match the expected value for given the Sun elevation at
   that time?/

The first one was relatively easy, I knew that the Firth of Forth was
somewhere behind the camera, but not exactly where or at what
distance. The second one was harder, because the bow separation
changes along the arcs. We'd ideally use vertical separation at the
apex, but the bows were far from complete, they faded out outside the
picture.

*** DONE Sun, Camera aaaaaaand Water!

I was lucky to find the [[https://www.suncalc.org/#/55.9316,-3.1718,11/2019.05.21/21:00/1/3][SunCalc site]], and used it to generate a map of
the area and that includes the Sun configuration relative to the
camera position at the time of observation (21/05/2019 21:00). This
saved me from having to aggregate the same information from different
sources.

#+ATTR_HTML: :alt SunConfig :width 80%
[[../img/Rainbow/Rainbow-2019-05-22-SunConfig.png]]

This image answers question 1, and provides useful data that will help
answer question 2:
- The Sun direction matched the observed rainbow orientation, with a
  and altitude of $2.7$ degrees above the horizon.
- The camera was pointing towards the left side of the rainbow from
  approximately 70m above sea level.
- There was a large water body that extends from $[10..16.5]$ km behind
  the camera, the Firth of Forth.

Assuming a perfect mirror water surface, we can infer that if the Sun
rays that caused the primary bow hit the rain droplets with an angle
of $\alpha_{p} = -2.7$ deg, then their specular reflection on the
water that caused the reflection bow hit the rain droplets at an angle
of $\alpha_{r} = 2.7$ deg.

*** TODO Reconstructing the full bows from partial picture

We need the apex heights of the primary and reflection bows, but they
were incomplete, so I manually reconstructed the full bows from the
partial picture, by mirroring it horizontally and matching a circle to
each bow in Inkscape. This is obviously an approximation, but the
conclusion seems to prove it was good enough, so hooray for Science.

#+ATTR_HTML: :alt Reconstructed bows :width 80%
[[../img/Rainbow/Rainbow-2019-05-22-RECONSTRUIT.png]]

From this picture the heights are $y_p = 242$ pixels (primary) and
$y_r = 284$ pixels (reflection)

*** Identifying a RR from sun inclination and primary/reflection separation

The green line in this picture is the separation between primary and
reflection bows.

Observer height was 70m and can be considered irrelevant, as it may
only change the perceived height of the bows over the horizon, but not
their relative configuration.

#+ATTR_HTML: :alt Angles :width 100%
[[../img/Rainbow/Rainbow_Angles.svg]]

Angles wrt horizon
  theta_p = 39.3deg
  theta_r = 44.7deg


* DONE Calcs

- By ear, the rainbow center was around 45 deg to my right wrt base
  point (behind chimmeney), casting a line from rainbow center
  direction backwards hits the Firth of Forth water mass at 10..15km.
- Ground height wrt sea level is 220ft (67m), from sea level, plus 3m
  at home, so 70m approx, but compared to dist to sea it's negligible
  http://en-gb.topographic-map.com/places/Edinburgh-89983/

** DONE Test 1: reflection/primary height ratio from Angles (inconclusive?)
- Does the image height (difference? ratio?) of the two bows in the
  picture match the predictied range for reflected bows at the
  existing range of distances to the sea?
- Just checking bow height difference AND the *known view angles for
  both wrt horizon* (from sun dir/angle from astro data + and
  reflected sunlights on a specular surface) we can decide if the bows
  may come from a reflection
- BUT we're NOT accounting for distance-to-see at all, just picture
  heights/ratios, so it's not conclusive? NOT necessarily, we're
  accounting for sun angle, we don't need more, do we?

Knowns:

Angles wrt horizon
  theta_p = 39.3deg
  theta_r = 44.7deg

Height wrt horizon, in picture
  y_p = 242 pixels
  y_r = 284 pixels

Unknowns:

Distance along horizon
  x_p == x_r

Assuming rectangle triangle wrt horizon, and assuming x_p == x_r
  tan(theta_p) = y_p / x
  tan(theta_r) = y_r / x

Thus, y_p / y_r should be tan(theta_p)/tan(theta_r), regardless of
unknown x.

  theta_r = tan(44.7) = 0.989582
  theta_p = tan(39.3) = 0.818491
  /= 1.209032231

  y_r = 284 pixels
  y_p = 242 pixels
  /= 1.173553719

Rel error:
  (1.209032231-1.173553719) / 1.209032231 = 3%

** DONE Test 2: Distances (to gold at the base!)

Now, a fun sideffect of knowing the approximate distance from the
camera to the water reflection is that it allows computing the
distance to the rainbow itself, which is NOT possible with a regular
bow.

- This site https://www.atoptics.co.uk/fz439.htm also wonders "how far
  is the rainbow", and explains there is no answer (for simple bows)


- HOW can we validate distance-to-sea is compatible with reflection?
- One idea is using d2s to compute actual height of the bows, and
  see if that's physically possible (1m would be stupid, 100km too)
- Distance to bow base could also be computed from d2s, and also
  tested for consistency
- How far was the gold at the base from me? combine X and Y to find
  it!

Knowns (reflection bow)
  Angles A=2.7, C=42, B = 135.3deg
  Distance-to-sea c = 10..16.5km, opposite to angle C

Distances from observer to rainbow h_r, opposite to angle A

Law of sines:
  a/sin(A) = b/sin(B) = c/sin(C)

So to find h_r == a from knowns
  a = c * sin(A)/sin(C)
    = c * sin(2.7)/sin(42)
    = c * 0.0703995

So for
  c = [10..16.5]km,

The distance to the top of the reflection bow is
  h_r = a = [0.7..1.16]km

And using h_r as hypotenusa, the horizontal distance to the bow base
would be
  cos(theta_r) = x_r / h_r
  x_r = h_r * cos(theta_r)
      = h_r * 0.710799
      = [0.497559..0.824527]km

And from this, we can compute height in km
  y_r = x_r * tan(theta_r)
      = x_r * 0.989582
      = [0.497559..0.824527] * 0.989582
      = [0.492375..0.815937]km

Finally, the distance to the pot of gold, which is the SAME to all
points in the bow, is therefore h_r = [0.7..1.16]km

** Accounting for camera height over sea level
According to https://en.wikipedia.org/wiki/Horizon, horizon distance
is d = 3.57*sqrt(h) (d in km, h in meters), so at h=70m above esea
level d = 30km, QUITE far away, so FoF sure falls inside it, and
actually, we should worry about horizon distance at rainbow height,
which may be quite far up (h=1000m approx in picture, if reflection at
farthest FoF border), so d = 113km, not far enough for the west coast

* References
- The [[https://atoptics.co.uk/][Atmospheric Optics]] website is a great reference for learning
  about the Rainbows and other phenomena, I would have never reached
  the bottom of this rabbit hole without it.
- This paper [[https://cs.dartmouth.edu/~wjarosz/publications/sadeghi11physically.html][Physically-based simulation of rainbows]] explains and
  reproduces several kinds of rainbows, including secondary bows,
  supernumeraries and twinned bows. It's worth a read.
