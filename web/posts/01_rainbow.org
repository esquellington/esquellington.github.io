#+title: That time I saw a weird rainbow
#+date: <2024-11-17 dom>
#+author: Oscar

In May 2019 I saw this mysterious rainbow over Edinburgh. At first
sight it may look like a common double rainbow, but if you focus on
the bases you can see that they intersect.

#+ATTR_HTML: :alt Weird Rainbow :width 75%
[[../img/Rainbow/Rainbow-2019-05-22-RETALLAT.jpeg]]

Double rainbows are concentric, so they're not supposed to
intersect...  there was definitely something else going on, so I
started reading to find out exactly what. It was a fun trip and I
ended up with satisfying answer ([[So, what did I see?][spoiler]]) and a new [[QUESTION][question]].

/(NB: All inline pictures are mine)/

* Rain-bows-tiary

After this terrible pun, let's have a quick look at the different
kinds of rainbows that have been observed and studied, and try to
classify the one in the picture above.

** Single rainbow
A single *primary* bow can be seen when sunlight rays are refracted
once inside rain droplets, split into different wavelengths (colours)
and travel towards the observer standing between the Sun and the
rainbow. Rays are refracted around /42 degrees/ downwards. More
details [[https://www.atoptics.co.uk/rainbows/primary.htm][here]].

~TODO~ side diagram of single reflection inside spherical droplet and angles

** Concentric rainbows
Single rainbows are awesome on their own, but sometimes they're
accompained by additional concentric bows:
- A *secondary* bow can appear around the primary one, caused by extra
  refractions of light inside rain doplets. The secondary bow is
  concentric to primary one, appears outside and is significantly
  fainter. The secondary bow colors are reversed. Primary + secondary
  form the relatively common "double rainbow" that everybody
  loves. More details [[https://www.atoptics.co.uk/rainbows/sec.htm][here]].
- Supernumerary bows can appear adjacent to the inside of any bow and
  seem to repeat the same color pattern, but compressed. They are
  caused by lightwave interference, it seems, which is very awesome
  but we won't dig any deeper for now. More detals [[https://www.atoptics.co.uk/rainbows/supers.htm][here]].

The picture below shows a faint secondary bow above the primary one,
and part of a supernumerary right below the primary violet shade.
#+ATTR_HTML: :alt Double Rainbow with supernumerary :width 90%
[[../img/Rainbow/Rainbow-2019-10-29-Super.jpg]]

These are very cool, but definitely not what I saw.

** Reflection rainbows
Reflection rainbows are formed by two separate bows: a primary one
caused by direct sunlight, and a *reflection* one above the primary,
caused by sunlight reflected on a water surface that must be behind
the observer, and calm enough for sunlight to reflect in a coherent
direction instead of scattering. The reflection bow is not concentric,
and appears above the primary one. More details [[https://www.atoptics.co.uk/rainbows/bowim6.htm][here]].

~TODO~ side diagram of primary + reflection ray trajectories inside
spherical droplets at 2 different heights/angles to same observer

** Twinned rainbows
Twinned rainbows are very rare, and apparently not yet fully
understood. A possible explanation is that they're primary bows that
bifurcate in some sections due to the presence of larger droplets that
become non-spherical under the effect of air friction, and refract
light in a slightly different direction, so the rays that reach the
observer come from slightly above/below the primary bow. More details
[[https://www.atoptics.co.uk/rainbows/bowim28.htm][here]].

* So, what did I see?
Given that the 2 bows in my picture were not concentric they could
only be a twinned primary bow, or a pair of primary and a reflection
bows. I very much suspected it was primary + reflection but I had no
proof. A sane person would have probably stopped there. I didn't.

My shamelessly biased starting assumption was: /If I can prove that a
reflection bow was very likely, then it probably was, given how rare
twinned bows seem to be, and how hard it would be to prove that it was
a twinned bow instead/.

So yeah, I essentially looked for my keys under the [[https://en.wikipedia.org/wiki/Streetlight_effect][streetlight]], not
where I had probably lost them. The good news is that using my
picture, some basic trigonometry and publically available maps and
astronomical data, I arrived at a pretty convincing answer: The top
bow in the picture matches a predicted *reflection bow* with
surprising accuracy (97%), so it most likely was. Below I'll detail
how I arrived at this conclusion

** Method

~TODO~ REUSE previous diagram with primary+reflection, compact angle

I unitaterally decided had to answer these 2 questions:
1. /Is there a water surface where the Sun may have reflected?/
2. /Does the separation between primary and reflection bows in the
   picture match the expected value, given the Sun elevation at that
   time?/

The first one was relatively easy, I knew that the Firth of Forth was
somewhere behind the camera, but not exactly where or at what
distance. The second one was harder, because the bow separation
changes along the arcs. We'd ideally use vertical separation at the
apex, but the bows were far from complete, they faded out outside the
picture.

*** Sun, Camera and Water

I was lucky to find the [[https://www.suncalc.org/#/55.9316,-3.1718,11/2019.05.21/21:00/1/3][SunCalc]] site, and used it to generate a map of
the area that includes the Sun configuration relative to the camera
position at the time of observation (21/05/2019 21:00).

#+ATTR_HTML: :alt SunConfig :width 90%
[[../img/Rainbow/Rainbow-2019-05-22-SunConfig.png]]

This image answers question 1, and provides data that will help answer
question 2:
- The Sun direction matched the observed rainbow orientation, with a
  and altitude of $2.7$ degrees above the horizon.
- There was a large water body that extends from
  $[10\text{km},16.5\text{km}]$ behind the camera, the Firth of Forth.

Assuming a perfect mirror water surface, we can infer that if the Sun
rays that caused the primary bow hit the rain droplets with an angle
of $\alpha_{p} = -2.7$ deg, then their specular reflection on the
water that caused the reflection bow hit the rain droplets at an angle
of $\alpha_{r} = +2.7$ deg.

*** Reconstructing the full bows from a partial picture

I needed the apex heights of the primary and reflection bows, but they
were incomplete, so I manually reconstructed the full bows from the
partial picture, by mirroring it horizontally and matching a circle to
each bow using [[https://inkscape.org/][Inkscape]]. This is obviously an approximation, but the
conclusion seems to prove it was good enough, so hooray for scrappy
Science.

#+ATTR_HTML: :alt Reconstructed bows :width 90%
[[../img/Rainbow/Rainbow-2019-05-22-RECONSTRUIT.png]]

From this picture I computed the heights in pixels: $y_p = 242$ pixels
(primary) and $y_r = 284$ pixels (reflection). I did not count the
pixels one by one, I promise.

*** Identifying a reflection bow from known angles and heights

Observer height above sea level was 70m ([[http://en-gb.topographic-map.com/][data]]) and can be considered
irrelevant, as it may only change the perceived height of the bows
over the horizon, but not their relative configuration.

View angles above the horizon are $\theta_p = 39.3$ deg and $\theta_r
= 44.7$ deg.

#+ATTR_HTML: :alt Angles :width 100%
[[../img/Rainbow/Rainbow_Angles.svg]]

Observer distances along the horizon to the primary $x_p$ and
reflection $x_r$ bows are unknown, but assumed to be equal $x_p = x_r
= x$, as they were most likely caused by the same curtain of rain
droplets.

Assuming bow apex heights in the picture are perpendicular to the
horizon, we have 2 rectangle triangles
\begin{eqnarray*}
  \tan(\theta_r) = y_r / x \\
  \tan(\theta_p) = y_p / x
\end{eqnarray*}

we can get rid of the unknown $x$ easily by dividing the 2 equations

\[\frac{\tan(\theta_r)}{\tan(\theta_p)} = \frac{y_r}{y_p}\]

and operating we arrive at $1.209 \approx 1.173$ with a relative error
of $3\%$, or, phrased in positive terms: an accuracy of $97\%$, not too bad!

*** Is this conclusive, can we improve it?

We have our answer, but I found it slightly unsatisfying. In
particular, we used known angles, but we did not need to consider the
distance to the water at all... so maybe we can use it to validate or
disprove the conclusion we arrived?

One idea is to compute /how high is the rainbow?/ and verify the
answer is reasonable. Clouds at Edinburgh's latitude extend between
roughly 500m to 10km above the sea (details later) so if we compute a
height that is significantly outside that range, it'd be suspicious.

*** <<QUESTION>> How +high+ *far* is the rainbow?

But it turns out that with the data we have it's easier to first
compute the observer distance to the rainbow, rather than its height
over the horizon... Whick is interesting, because the distance to the
rainbow cannot be computed for a single primary bow, in general. The
reason is that it could be *anywhere* along the viewing direction, and
for a single bow we have no additional data to triangulate its height
(details [[https://www.atoptics.co.uk/fz439.hth][here]]). Fortunately, we know the distance to the water
reflection, so we can compute the height of the (supposed) reflection
bow, but not the primary one.

Knowns (reflection bow)
  Angles A=2.7, C=42, B = 135.3deg
  Distance-to-sea c = 10..16.5km, opposite to angle C

*TODO* repeat diagram with angles/lenghts vars used below

Distances from observer to rainbow $h_r$, opposite to angle $A$

Law of sines
\[
  \frac{a}{\sin(A)} = \frac{b}{\sin(B)} = \frac{c}{\sin(C)}
\]

So to find $h_r = a$ from knowns
\[ a = c \frac{\sin(A)}{\sin(C)} = c \frac{\sin(2.7)}{\sin(42)} =
[10..16.5] \times 0.0704 = [0.7..1.16] \text{km}
\]

And using $h_r$ as hypotenusa, the horizontal distance $x_r$ to the
bow base would be
\[
  x_r = h_r \cos(\theta_r) = [0.7..1.16] \times 0.710 = [0.497..0.824] \text{km}
\]

And from this, we can compute height $y_r$ in km
\[
  y_r = h_r \sin(\theta_r) = [0.7..1.16] \times 0.703 = [0.492,0.816] \text{km}
\]

This height range, roughly 500m to 800m, is very much within the
expected values for low clouds, from 500m to 3km, according
https://www.weather.gov/key/low_clouds, and the clouds in the picture
look pretty low indeed, so I'm finally convinced: this was a
reflection rainbow, and my lost keys were under the streetlight.

** Accounting for camera height over sea level                     :noexport:
According to https://en.wikipedia.org/wiki/Horizon, horizon distance
is d = 3.57*sqrt(h) (d in km, h in meters), so at h=70m above esea
level d = 30km, QUITE far away, so FoF sure falls inside it, and
actually, we should worry about horizon distance at rainbow height,
which may be quite far up (h=1000m approx in picture, if reflection at
farthest FoF border), so d = 113km, not far enough for the west coast

* References
- The [[https://atoptics.co.uk/][Atmospheric Optics]] website is a great reference for learning
  about the Rainbows and other phenomena, I would have never reached
  the bottom of this rabbit hole without it.
- This paper [[https://cs.dartmouth.edu/~wjarosz/publications/sadeghi11physically.html][Physically-based simulation of rainbows]] explains and
  reproduces several kinds of rainbows, including secondary bows,
  supernumeraries and twinned bows. It's worth a read.
